<div class="container">

  <!-- Table -->

	<div class="row">

	  <div class="col-md-6">

		<div class="widget">

		<div class="widget-head">
		  <div class="pull-left"  style="width:100%; text-align:center">Bảng thống kê </div>
		  <div class="widget-icons pull-right">
			<a href="#" class="wminimize"><i class="fa fa-chevron-up"></i></a> 
			<a href="#" class="wclose"><i class="fa fa-times"></i></a>
		  </div>  
		  <div class="clearfix"></div>
		</div>

		  <div class="widget-content">
			
			<div class="table-responsive">
				<table class="table table-striped table-bordered table-hover nowrap compact " style="color:#0C4B7F">
				  <thead>
					<tr style="white-space:nowrap; text-align:center;">
						<th>Stt</th>						
						<th>Đơn vị QL</th>							
						<th>Họ và tên</th>
						<th>Tên TK</th>						
						<th>Mã TK</th>
						<th>Mã ĐL</th>	
						<th>Truy cập gần nhất</th>						
					</tr>
						
				  </thead>
				  <tbody class="tbody-content">
						
				  </tbody>
				</table>
			</div>
			
			
		   <div class="widget-foot">

			  
				<ul class="pagination pagination-sm pull-right">
				  <li><a href="#">Prev</a></li>
				  <li><a href="#">1</a></li>
				  <li><a href="#">2</a></li>
				  <li><a href="#">3</a></li>
				  <li><a href="#">4</a></li>
				  <li><a href="#">Next</a></li>
				</ul>
			  
			  <div class="clearfix"></div> 

			</div>

		  </div>
		</div>

	  </div>
	  
	  
	<div class="col-md-6 userdetail_table">

		<div class="widget userdetail">

		<div class="widget-head">
		  <div class="pull-left"  style="width:100%; text-align:center">Bảng quản lý thao tác dữ liệu thông tin các Nhà máy</div>
		  <div class="widget-icons pull-right">
			<a href="#" class="wminimize"><i class="fa fa-chevron-up"></i></a> 
			<a href="#" class="wclose"><i class="fa fa-times"></i></a>
		  </div>  
		  <div class="clearfix"></div>
		</div>

		  <div class="widget-content">
			
			<div class="table-responsive">
				<table class="table table-striped table-bordered table-hover  order-table " style="color:#0C4B7F">
				  <thead>
					<tr style="white-space:nowrap; text-align:center; background-color:#BBFC7F ;">
						<th>Trường dữ liệu</th>
						<th>Thông số</th>
						<th >Thông tin</th>						
						<th>Trường dữ liệu</th>
						<th>Thông số</th>
						<th >Thông tin</th>							
					</tr>				  
					<tr style="white-space:nowrap; ">
						<th>Đơn vị QL</th>
						<td></td>
						<td class="input_text" id="user_pc_name" data-name="pcname"></td>						
						<th>ID Điện lực</th>
						<td></td>
						<td  class="input_text" id="user_id_pwc" data-name="pcid"></td>						
					</tr>	
					<tr style="white-space:nowrap;">
						<th>ID chủ đầu tư</th>
						<td></td>
						<td  class="input_text" id="user_id_investor" data-name="investorid"></td>						
						<th>ID nhà máy</th>
						<td></td>
						<td  class="input_text" id="user_id_sub" data-name="subid"></td>						
					</tr>
					<tr style="white-space:nowrap;">
						<th>Họ và tên</th>
						<td></td>
						<td  class="input_text" id="user_full_name" data-name="fullname"></td>						
						<th>Tên TK</th>
						<td>int(10)</td>
						<td  class="input_text" id="user_user_name" data-name="username"></td>						
					</tr>
					<tr style="white-space:nowrap; ">
						<th class="pwdtitle" style="color: blue; font-size: 14px;">Mật khẩu</th>
						<td>int(11)</td>
						<td  class="input_text pwd" id="user_password" data-name="password">********</td>						
						<th>Tên đơn vị</th>
						<td>int(10)</td>
						<td  class="input_text" id="user_office_name" data-name="officename"></td>						
					</tr>

					<tr style="white-space:nowrap; ">
						<th>Phone</th>
						<td>char(100)</td>
						<td  class="input_text" id="user_phone_number" data-name="phone"></td>						
						<th>Email</th>
						<td>char(100)</td>
						<td  class="input_text" id="user_email" data-name="email"></td>						
					</tr>
					<tr style="white-space:nowrap; ">
						<th>Enable/Disable</th>
						<td>tinyint(1)</td>
						<td  class="input_text" id="user_enable" data-name="enable"></td>						
						<th>Lần đăng nhập gần nhất</th>
						<td>char(30)</td>
						<td  class="input_text" id="user_last_visit" data-name="lastvisit"></td>						
					</tr>		
					<tr style="white-space:nowrap; ">
						<th>Lượt truy cập</th>
						<td>varchar(10)</td>
						<td  class="input_text" id="user_visit_number" data-name="visitnumber"></td>						
						<th>ngày cấp tài khoản</th>
						<td>varchar(10)</td>
						<td  class="input_text" id="user_register_date" data-name="regdate"></td>						
					</tr>					
					<tr style="white-space:nowrap; ">
						<th>Quyền write</th>
						<td>int(1)</td>
						<td  class="input_text" id="user_writable" data-name="writable"></td>						
						<th>Nhóm User</th>
						<td>varchar(50)</td>
						<td  class="input_text" id="user_usertype" data-name="usertype"></td>						
					</tr>	
					<tr style="white-space:nowrap; ">
						<th>Quyền sửa</th>
						<td>int(1)</td>
						<td  class="input_text" id="user_editable" data-name="editable"></td>						
						<th class="user_permission" style="color: blue; font-size: 14px;">Phân quyền</th>
						<td class="user_permission">Text</td>
						<td  class="input_text user_permission permisioninput" id="user_permission" data-name="permission"></td>						
					</tr>					

						
				  </thead>
				  <tbody class="tbody-content-details">
						
				  </tbody>
				</table>
			</div>
			
			
		   <div class="widget-foot">

			  
				<button  class="btn btn-primary user_addnew_btn" style="margin-top: 5px;"> Thêm mới </button>
				<button  class="btn btn-primary user_edit_btn" style="margin-top: 5px;"> Sửa </button>

				<button  class="btn disabled user_edit_confirm_btn" style="margin-top: 5px;"> Xong </button>
				<button  class="btn disabled user_edit_save_btn" style="margin-top: 5px;"> Lưu lại </button>
				<span> - - </span>
			  	<button  class="btn btn-warning user_cancel_btn" style="margin-top: 5px;"> Hủy bỏ </button>
			  	<span> - - </span>
			  	<button  class="btn btn-warning user_del_btn" style="margin-top: 5px;"> Xóa USER </button>
			  <div class="clearfix"></div> 

			</div>

		  </div>
		</div>

	  </div>  
	  
	  

	</div>

</div>
		 

		<!-- Matter ends -->

<script>

pwdtemp = '';
user_editing = 0;
edit_userid = 0;

task = 0; //task = 1 - thêm mới/ = 2 edit
crpage = getpage();
crmenu = getdefaulthash();
crdongnm=0;
count_click_plus=0;
input_doing=0;

//sendcrpos();

$('.mainmenu').text(namepage[crpage]);
$('.listmenu').text(submenu[crmenu]);
var all_user='';

init_info();



var now = 0;
if($('body').find('.userdetail_table').length != 0){
    var target = $('.userdetail_table').offset().top;
}

$(window).scroll(function(){
    now = $(this).scrollTop();
	console.log('now:'+now);
    //if(!$('.userdetail_table').hasClass('not-fixed')){
        if(now > 128){
        	//if(!$('.userdetail_table').hasClass('fixed_table')){
        		$('.userdetail_table').addClass('fixed_table');
        		console.log('addClass fixed');
        	//}
            
            
        }else{
        	//if (!$('.userdetail_table').hasClass('fixed_table')){
        		$('.userdetail_table').removeClass('fixed_table');
            	console.log('removeClass fixed');
        	//}
            
        }
    //}
});

function init_info(){
	$.ajax({
		  url:'http://mdms.npc.com.vn/mdms2015/admin/apis/qluserconfig.php',
		      type:"POST",
		      data:{id:userid, token:token},
		      success:function(data){
				 data = JSON.parse(data);
				 all_user = data;
				 //console.log(data);
		          var html = ''; html1='';
				  var dongnm=1, dongpc=1; // các biến để lưu giá trị dòng của các nhà máy và điện lực
		          $.each(data,function(index, value){
					 var nm = ''; nm1='';
					 $.each(value['list_users'],function(index1, value1){
		              
		              //html tạo bảng chứa thông tin các nhà máy - tạo các dòng chứa thông tin nhà máy

		              nm+='<tr class="underpower user_detail" >'+
						'<td >'+dongnm+'</td>'+
						'<td ></td>'+
						'<td >'+value1['full_name']+'</td>'+
						'<td >'+value1['user_name']+'</td>'+
						'<td class="td_userid" >'+value1['ID']+'</td>'+
						'<td class="td_pcid" >'+value1['id_pwc']+'</td>'+
						'<td class="td_pcid" >'+value1['last_visit']+'</td>'+				
						'</tr>';	
						dongnm++;

		            });
					
					//html tạo bảng chứa thông tin các điện lực - tạo các dòng chứa thông tin điện lực
					
					indexx=index+1; 				
		            html+='<tr class="power" style="white-space:nowrap;"><td >'+ romanize(indexx)+'</td>'+
		                  '<td >'+value['pc_name']+'</td>'+	  
		                  '<td></td><td></td>'+
		                  '<td></td><td></td>'+                  
		                '</tr>'+nm; 
					
					dongpc++;	
		          });
					
					//html gán vào table
					
				$('.tbody-content').html(html);

				
				var count_click=0,crrow='';
				$(".edit_sub").click(function(){
					
					if (count_click==0 && input_doing==0) {
					
						crrow =$(this).attr('id'); // dong hien tai		
						console.log($(this).parent().find('td .sub1'));
						
						$(this).parent().find('td .sub1').html('<input class="input1" placeholder="" style="width:50px;" value="'+ $(this).parent().find('td .sub1').text() +'" />');
						$(this).parent().find('td .sub2').html('<input class="input2" placeholder="" style="width:50px;" value="'+ $(this).parent().find('td .sub2').text() +'"/>');
						$(this).parent().find('td .sub3').html('<input class="input3" placeholder="" style="width:50px;" value="'+ $(this).parent().find('td .sub3').text() +'" disabled/>');
						$(this).parent().find('td .sub4').html('<input class="input4" placeholder="" style="width:100px;" value="'+ $(this).parent().find('td .sub4').text() +'"/>');
						$(this).parent().find('td .sub5').html('<input class="input5" placeholder="" style="width:100px;" value="'+ $(this).parent().find('td .sub5').text() +'"/>');
						$(this).parent().find('td .sub6').html('<input class="input6" placeholder="" style="width:200px;" value="'+ $(this).parent().find('td .sub6').text() +'"/>');
						$(this).parent().find('td .sub7').html('<input class="input7" placeholder="" style="width:300px;" value="'+ $(this).parent().find('td .sub7').text() +'"/>');
						$(this).parent().find('td .sub8').html('<input class="input8" placeholder="" style="width:50px;" value="'+ $(this).parent().find('td .sub8').text() +'" disabled/>');
						$(this).parent().find('td .sub9').html('<input class="input9" placeholder="" style="width:150px;" value="'+ $(this).parent().find('td .sub9').text() +'" disabled/>');
						$(this).parent().find('td .sub10').html('<input class="input10" placeholder="" style="width:50px;" value="'+ $(this).parent().find('td .sub10').text() +'"/>');
						$(this).parent().find('td .sub11').html('<input class="input11" placeholder="" style="width:50px;" value="'+ $(this).parent().find('td .sub11').text() +'"/>');
						$(this).parent().find('td .sub12').html('<input class="input12" placeholder="" style="width:50px;" value="'+ $(this).parent().find('td .sub12').text() +'"/>');
						$(this).parent().find('td .sub13').html('<input class="input13" placeholder="" style="width:50px;" value="'+ $(this).parent().find('td .sub13').text() +'" disabled/>');
						$(this).parent().find('td .sub14').html('<input class="input14" placeholder="" style="width:50px;" value="'+ $(this).parent().find('td .sub14').text() +'"/>');
						$(this).parent().find('td .sub15').html('<input class="input15" placeholder="" style="width:100px;" value="'+ $(this).parent().find('td .sub15').text() +'"/>');	
						
						$(this).closest('tr').css("background-color", "#F0D29B");// danh dau dang sua
						count_click=1; // set biến kiểm tra click on/off để báo là đang click vào nút Edit
						input_doing=1;
						
					} else {			
						if ($(this).attr('id')==crrow && count_click==1) {	
						
							count_click=0; // set lại biến kiểm tra click on/off về khởi tạo 
							alert ('count_click:'+ count_click);
							input_doing=0;
							
							for (l=1;l<16;l++){
								tmp1= $('.input'+l).val();
								$(this).parent().find('td .sub'+l).text(tmp1);
								checksecurity (); //kiem tra password truoc khi ket thuc chinh sua
							}	
							
						} else {showalert('Thông báo!', 'hay hoan thanh viec chinh sua truoc khi sua nha may khac!');}				
					}
				});			
				
				// xu ly them moi nha may tai cac cong ty Dien luc
				var crrowpc=0,cridpc='';
				crdongnm=dongnm;
				
				$(".plus_sub").click(function(){
					alert($(this).closest('tr').attr('id'));
					if (count_click_plus==0 && input_doing==0) {
					
						cridpc =$(this).find('span').attr('id'); // lấy ID của điện lực hiện tại cho vào giá trị input
						
						newrow=$('<tr class="underpower" style="white-space:nowrap;" id="plus_sub_row'+crdongnm+'"><td >'+crdongnm+'</td>'+
						'<td class="edit_sub" id="row'+crdongnm+'" style="cursor:pointer;"><i class="fa fa-pencil "></i></td>'+
						'<td class="delete_sub" id="rowa'+crdongnm+'"><i class="fa fa-trash-o "></i></td>'+				  
						'<td class="ok" >mới</td><td></td>'+
						'<td class="plus_sub1"><input class="plus1" placeholder="" style="width:50px;" value="'+cridpc+'" disabled /> </td>'+
						'<td class="plus_sub2"><input class="plus2" placeholder="" style="width:50px;" /></td>'+
						'<td class="plus_sub3"><input class="plus3" placeholder="" style="width:50px;" /></td>'+
						'<td class="plus_sub4"><input class="plus4" placeholder="" style="width:100px;" /></td>'+
						'<td class="plus_sub5"><input class="plus5" placeholder="" style="width:100px;" /></td>'+
						'<td class="plus_sub6"><input class="plus6" placeholder="" style="width:200px;" /></td>'+
						'<td class="plus_sub7"><input class="plus7" placeholder="" style="width:300px;" /></td>'+
						'<td class="plus_sub8"><input class="plus8" placeholder="" style="width:50px;" disabled/></td>'+
						'<td class="plus_sub9"><input class="plus9" placeholder="" style="width:150px;" disabled/></td>'+
						'<td class="plus_sub10"><input class="plus10" placeholder="" style="width:50px;" /></td>'+
						'<td class="plus_sub11"><input class="plus11" placeholder="" style="width:50px;" /></td>'+
						'<td class="plus_sub12"><input class="plus12" placeholder="" style="width:50px;" /></td>'+
						'<td class="plus_sub13"><input class="plus13" placeholder="" style="width:50px;" disabled /></td>'+
						'<td class="plus_sub14"><input class="plus14" placeholder="" style="width:50px;"/></td>'+
						'<td class="plus_sub15"><input class="plus15" placeholder="" style="width:100px;" /></td>'+               
						'</tr>');			
					
						crrowpc =$(this).closest('tr').attr('id'); 
						
						alert (cridpc);
						$('#'+crrowpc).after(newrow); //thêm dòng mới vào sau element có id  crrowpc
						
						count_click_plus=1;
						input_doing=1;
						
						crdongnm_cancel=crdongnm; // dùng cho việc xóa dòng khi bấm vào cancel
						crdongnm=crdongnm+1; // tăn dần id dòng mỗi lần click vào plus				
						
					} else {
					
						if ($(this).closest('tr').attr('id')==crrowpc && count_click_plus==1) {
						
							count_click_plus=0;
							input_doing=0;
							
							for (m=1;m<16;m++){
								tmp1= $('.plus'+m).val();
								$('.plus_sub'+m).text(tmp1);
								checksecurity (); //kiem tra password truoc khi ket thuc chinh sua
							}						
							
						} else {
							showalert('Thông báo!', 'hãy hoàn thành công tác đang xử lý trước khi chuyển sang công tác khác!');
						}
						
					}
				});		
				
				
				$('.user_detail').click(function(){
					
					cancel_editing();

					var number_user = 0;
					number_usser = $(this).find('.td_userid').html();
					number_pc = $(this).find('.td_pcid').html();
					keyuser='id_'+number_usser;
					keypc='pcid_'+number_pc;
					//console.log(all_user);
					//alert (all_user[keypc].list_users[keyuser].full_name);	
					$('#user_pc_name').html(all_user[keypc].pc_name);
					$('#user_id_pwc').html(all_user[keypc].list_users[keyuser].id_pwc);
					$('#user_id_investor').html(all_user[keypc].list_users[keyuser].id_investor);
					$('#user_id_sub').html(all_user[keypc].list_users[keyuser].id_sub);
					$('#user_full_name').html(all_user[keypc].list_users[keyuser].full_name);
					$('#user_user_name').html(all_user[keypc].list_users[keyuser].user_name);
					//$('#user_password').html(all_user[keypc].list_users[keyuser].password);
					$('#user_password').html('*********');
					$('#user_office_name').html(all_user[keypc].list_users[keyuser].office_name);
					$('#user_phone_number').html(all_user[keypc].list_users[keyuser].phone_number);
					$('#user_email').html(all_user[keypc].list_users[keyuser].email);
					$('#user_enable').html(all_user[keypc].list_users[keyuser].enable);
					$('#user_last_visit').html(all_user[keypc].list_users[keyuser].last_visit);
					$('#user_visit_number').html(all_user[keypc].list_users[keyuser].visit_number);
					$('#user_register_date').html(all_user[keypc].list_users[keyuser].register_date);
					$('#user_writable').html(all_user[keypc].list_users[keyuser].writable);
					$('#user_usertype').html(all_user[keypc].list_users[keyuser].usertype);
					$('#user_editable').html(all_user[keypc].list_users[keyuser].editable);
					$('#user_flag_change').html(all_user[keypc].list_users[keyuser].flag_change);
					$('#user_permission').html(all_user[keypc].list_users[keyuser].permission);
					
					var pw = all_user[keypc].list_users[keyuser].password;
					if (pw=='202cb962ac59075b964b07152d234b70'){
						$('#user_password').css('color','rgb(187, 149, 28)');
					} else {
						$('#user_password').css('color','black');
					}

					edit_userid = $(this).find('.td_userid').html();

				});

				
				$('.user_addnew_btn').click(function(){

					if (user_editing == 0){
						task = 1;
						user_editing = 1;
						$('.input_text').each(function(){
						
							if (!$(this).hasClass('pwd')){
								
								$(this).html('<input type="text">');
								
							} else {
								$(this).html('<input type="password">');
							}

							$('.user_edit_confirm_btn').removeClass('disabled').addClass('btn-primary');
							$('.user_edit_save_btn').removeClass('btn-primary').addClass('disabled');
							$('.user_edit_btn').removeClass('btn-primary').addClass('disabled');
							
						});

					}
					
				});
				

				$('.user_edit_btn').click(function(){

					if (user_editing == 0){

						user_editing = 1;

						task = 2;


						$('.input_text').each(function(){
						
							var text = $(this).html();

							if (!$(this).hasClass('pwd')){
								
								$(this).html('<input type="text" value="'+text+'">');
								
							} else if (!$(this).hasClass('permisioninput')) {
								$(this).html('<input type="password" value="'+text+'">');
							} else {
								$(this).html('<input type="password" value="">');
							}

							$('.user_edit_confirm_btn').removeClass('disabled').addClass('btn-primary');
							$('.user_edit_save_btn').removeClass('btn-primary').addClass('disabled');
							$('.user_addnew_btn').removeClass('btn-primary').addClass('disabled');
							
						});

						$('#user_user_name input').prop('disabled', true);

					}
					
				});


				 
				$('.user_edit_confirm_btn').click(function(){

					check_inputtext_empty(finishediting);

				});

				$('.user_edit_save_btn').click(function(){
					if (user_editing == 0) {
						
						checksecurity(usersave_callback);
						
						$('.user_edit_confirm_btn').removeClass('btn-primary').addClass('disabled');
						$('.user_edit_save_btn').removeClass('btn-primary').addClass('disabled');
						$('.user_addnew_btn').removeClass('disabled').addClass('btn-primary');
						$('.user_edit_btn').removeClass('disabled').addClass('btn-primary');

					}
				});

				$('.user_cancel_btn').click(function(){

					cancel_editing();

				});

				
				$('.user_permission').click(function(){

					//console.log(edit_userid+' - - '+task+' -  - '+user_editing);

					if((edit_userid<=0)&&(task == 2)){
					//if(edit_userid<=0){
						showalert('Thông báo', 'Bạn hãy chọn người dùng trước khi edit!', 11000);
					} else if(user_editing == 0){
					//if(edit_userid<=0){
						showalert('Thông báo', 'Bạn hãy chọn chế độ thêm mới hoặc chỉnh sửa trước khi set permission!', 11000);
					} else {
						//console.log('here');
						show_permission_dialog();
					}
					
				});

				$('.pwdtitle').click(function(){
					//change_user_pwd();
					change_pwd_dialog();
				});

		      },
		      error:function(e){
		          console.log('e '+e);
		      }
		});
}

function change_pwd_dialog(){

	var inputcontent =  '<div style="text-align: center;font-size: 16px;font-weight: 500;margin-top: 15px;">THAY ĐỔI MẬT KHẨU</div>'+
						'<div style="text-align: center; font-size: 15px;margin-top: 8px;">Bạn hãy nhập mật mới</div>'+
						'<div style="margin:18px 10px; "><input type="password" id="inputpassword" placeholder="Mật khẩu mới" style="width: 100%;"></div>'+
						'<div class="btnxacnhaninput btn btn-success" style="margin-left:10px;">Xác nhận</div><div class="btn btn-warning btnhuybo" style="margin-left:20px;">Hủy bỏ</div>';

	if (!$('.inputdialog').length) {

	  var $divbg = $('<div id="inputdialog" class="inputdialog" style="height: 100%;background-color: rgba(0,0,0,0.5);position: fixed;top: 0px;left: 0px;right: 0px;z-index: 10002;"></div>').appendTo('body');

	  var $divcontent = $('<div id="inputdialogcontent" style="position: absolute;left: 50%;top: 50%;transform: translate(-50%, -50%);background-color: rgb(255,255,255);height: 200px;width: 360px;z-index: 10001;border-radius: 5px;padding: 10px;"></div>').appendTo($('#inputdialog'));
	  $('#inputdialogcontent').html(inputcontent);
	  
	  $('#inputpassword').focus();

	}

	  $('.btnhuybo').click(function(){
		  $('#inputdialog').remove();
		  return false;
	  });

	$('.btnxacnhaninput').click(function(){

		var pwd = $('#inputpassword').val();
		change_user_pwd(pwd);

	});

}

function change_user_pwd(password){

	var apilink = 'http://mdms.npc.com.vn/mdms2015/admin/apis/qluserconfig_change_userpass.php';
	$.ajax({
		url:apilink,
			type:"POST",
			data:{userid:edit_userid, password:password},
			success:function(data){
				// console.log(data);
				data = JSON.parse(data);
				showalert_withcallback('Thông báo', data.content, 11000);
				$('#inputdialog').remove();
			},
			error:function(e){ $('#inputdialog').remove(); }
	});

}


function show_permission_dialog(){

	if (!$('.permissiondialog').length) {
		var $divbg = $('<div class="permissiondialog" style="height: 100%; background-color: rgba(255,255,255,1);position: fixed;top: 0px;left: 0px;right: 0px;z-index:10000;"></div>').appendTo('body');
		$('.permissiondialog').load('template/pages/qlnm/setuserpermission.html');
	}

}

$('.user_del_btn').click(function(){
	showalert('Thông báo', 'Chúc mừng bạn đã xóa sạch dữ liệu thành công!', 11000);
});

function get_text_input(){

	var obj = {};

	$('.input_text').each(function(){
		
		obj[$(this).data('name')] = $(this).html()

		if ($(this).hasClass('pwd')){

			$(this).html(pwdtemp);
			obj[$(this).data('name')] = pwdtemp;

		}

	});

	return obj;
}


function check_inputtext_empty(callbackfnc){
	
	var boo = 1;
	$('.input_text').each(function(){
				
		var text = $(this).find('input').val();

		if (text==''){
			boo = 0;
		} 
		
	});

	if ((boo == 1) && (typeof callbackfnc === 'function')) { callbackfnc(); }
	if (boo == 0) { 
		showalert('Thông báo', 'Bạn hãy điền đầy đủ thông tin trước khi tiếp tục', 11000);
		//alert('Bạn hãy điền đầy đủ thông tin trước khi tiếp tục');
	}
}


function usersave_callback(){

	var obj = get_text_input();
	var apilink='http://mdms.npc.com.vn/mdms2015/admin/apis/qluserconfig_editinfo.php';
	//console.log(edit_userid, obj);

	if (task == 1) {
		apilink='http://mdms.npc.com.vn/mdms2015/admin/apis/qluserconfig_createnew.php';
	}

	obj = JSON.stringify(obj);
	//console.log(obj);

	$.ajax({
		url:apilink,
			type:"POST",
			data:{userid:edit_userid, info:obj},
			success:function(data){
				// console.log(data);
				data = JSON.parse(data);
				showalert_withcallback('Thông báo', data.content, 11000, init_info);
			},
			error:function(e){ }
	});

	task = 0;

}


function cancel_editing(){

	finishediting();
	$('.user_edit_confirm_btn').removeClass('btn-primary').addClass('disabled');
	$('.user_edit_save_btn').removeClass('btn-primary').addClass('disabled');
	$('.user_addnew_btn').removeClass('disabled').addClass('btn-primary');
	$('.user_edit_btn').removeClass('disabled').addClass('btn-primary');

}

function finishediting(){
	user_editing = 0;

	$('.input_text').each(function(){
		if (!$(this).hasClass('pwd')){
			var text = $(this).find("input").val();
			//$(this).find("input").prop('')
			$(this).html(text);
			
		} else {
			pwdtemp = $(this).find("input").val();
			$(this).find("input").prop('disabled', true);
			//$(this).html('********');
			
		}

		$('.user_edit_confirm_btn').removeClass('disabled').addClass('btn-primary');
		$('.user_edit_save_btn').removeClass('btn-primary').addClass('disabled');

		
	});

	$('.user_edit_save_btn').removeClass('disabled').addClass('btn-primary');
}


// hàm kiểm tra password và xác nhận việc cập nhật, thay đổi thông tin
		
function checksecurity(callbackfnc){

	var inputcontent =  '<div style="text-align: center;font-size: 16px;font-weight: 500;margin-top: 15px;">Thông báo</div>'+
						'<div style="text-align: center; font-size: 15px;margin-top: 8px;">Bạn hãy nhập mật khẩu xác nhận</div>'+
						'<div style="margin:18px 10px; "><input type="password" id="inputpassword" placeholder="Mật khẩu" style="width: 100%;"></div>'+
						'<div class="btnxacnhaninput btn btn-success" style="margin-left:10px;">Xác nhận</div><div class="btn btn-warning btnhuybo" style="margin-left:20px;">Hủy bỏ</div>';

	if (!$('.inputdialog').length) {

	  var $divbg = $('<div id="inputdialog" class="inputdialog" style="height: 100%;background-color: rgba(0,0,0,0.5);position: fixed;top: 0px;left: 0px;right: 0px;z-index: 10002;"></div>').appendTo('body');

	  var $divcontent = $('<div id="inputdialogcontent" style="position: absolute;left: 50%;top: 50%;transform: translate(-50%, -50%);background-color: rgb(255,255,255);height: 200px;width: 360px;z-index: 10001;border-radius: 5px;padding: 10px;"></div>').appendTo($('#inputdialog'));
	  $('#inputdialogcontent').html(inputcontent);
	  
	  $('#inputpassword').focus();

	}

	  $('.btnhuybo').click(function(){
		  $('#inputdialog').remove();
		  if (count_click_plus==0){ 				  
			$('#plus_sub_row'+crdongnm_cancel).remove();
			crdongnm=crdongnm_cancel;					
		  }
		  return false;
	  });

	  $('.btnxacnhaninput').click(function(){

		  var pass= $('#inputpassword').val();
		  $.post('http://mdms.npc.com.vn/mdms2015/apis/xacnhanpass.php',{userid:userid,password:pass}, function(data){
			  //alert(data);
			  if (data == 500){
				showalert('Thông báo', 'Lỗi kết nối server, bạn hãy thử lại lần sau!', 11000);
				return false;
			  } else if (data == 404){
				showalert('Thông báo', 'Sai mật khẩu, bạn hãy thử lại lần sau!', 11000);
				return false;
			  } else if (data == 200) {
				//console.log('thanh cong');
				$('#inputdialog').remove();
				if(callbackfnc) {callbackfnc();}
				//replace_chiso(csdauky, cscuoiky);
				return true;

			  }else if (data == 404){
				showalert('Thông báo', 'Xác nhận mật khẩu thất bại!', 11000);
				return false;
			  }
		  });
		  return false;
	  });

}

/*
* hàm chuyển đổi số sang số la mã
*/
function romanize (num) {
	if (!+num)
		return false;
	var digits = String(+num).split(""),
		key = ["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM",
			   "","X","XX","XXX","XL","L","LX","LXX","LXXX","XC",
			   "","I","II","III","IV","V","VI","VII","VIII","IX"],
		roman = "",
		i = 3;
	while (i--)
		roman = (key[+digits.pop() + (i * 10)] || "") + roman;
	return Array(+digits.join("") + 1).join("M") + roman;
}

</script>

<script src="js/jquery.dataTables.min.js"></script> <!-- Data tables -->

<style type="text/css">

	.fixed_table {
		position:fixed; 
		right:0px;
		top:55px;
	}
	.input_text input {
		width: 120px;
		border: 1px solid black;
	}
	.user_detail, .user_permission, .pwdtitle{
		cursor: pointer;
	}
</style>
